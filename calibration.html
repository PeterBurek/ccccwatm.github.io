<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>11. Calibration tool &mdash; Community Water Model</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="_static/iiasa.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="12. Calibration tutorial" href="calibration_tutorial.html" />
    <link rel="prev" title="10. Data" href="data.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Community Water Model
              <img src="_static/IIASA_logo_white.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.0.6
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="modeldesign.html">2. Model Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="publication.html">3. Publication</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">4. Setup of the model</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">5. Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="errorHandling.html">6. Error handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="listVariables.html">7. List of output variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="results.html">8. Demo of the model</a></li>
<li class="toctree-l1"><a class="reference internal" href="todo.html">9. The Model Itself</a></li>
<li class="toctree-l1"><a class="reference internal" href="data.html">10. Data</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">11. Calibration tool</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#calibration-method">Calibration method</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#further-ideas-for-calibration">Further ideas for calibration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#suggested-calibration-parameters">Suggested Calibration parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="#calibration-tool-structure">Calibration tool structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-it-works">How it works</a></li>
<li class="toctree-l2"><a class="reference internal" href="#what-is-needed">What is needed</a></li>
<li class="toctree-l2"><a class="reference internal" href="#recommendations">Recommendations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="calibration_tutorial.html">12. Calibration tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="resolution.html">13. Increasing resolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="zambezi.html">14. Example Zambezi</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">15. License and download info</a></li>
<li class="toctree-l1"><a class="reference internal" href="sourcecode.html">16. Source code</a></li>
<li class="toctree-l1"><a class="reference internal" href="forum.html">17. Forum</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Community Water Model</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active"><span class="section-number">11. </span>Calibration tool</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/calibration.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="calibration-tool">
<h1><span class="section-number">11. </span>Calibration tool<a class="headerlink" href="#calibration-tool" title="Permalink to this heading"></a></h1>
<div class="line-block">
<div class="line">Calibration tool for hydrological models</div>
<div class="line">in ../CWatM/calibration</div>
</div>
<div class="line-block">
<div class="line">using a distributed evolutionary algorithms in python: DEAP library</div>
<div class="line"><a class="reference external" href="http://deap.readthedocs.io/en/master/">http://deap.readthedocs.io/en/master/</a></div>
<div class="line"><a class="reference external" href="https://github.com/DEAP/deap/blob/master/README.md">https://github.com/DEAP/deap/blob/master/README.md</a></div>
</div>
<p>Félix-Antoine Fortin, François-Michel De Rainville, Marc-André Gardner, Marc Parizeau and Christian Gagné, “DEAP: Evolutionary Algorithms Made Easy”, Journal of Machine Learning Research, vol. 13, pp. 2171-2175</p>
<div class="line-block">
<div class="line">The calibration tool was created by Hylke Beck 2014 (JRC, Princeton) <a class="reference external" href="mailto:hylkeb&#37;&#52;&#48;princeton&#46;edu">hylkeb<span>&#64;</span>princeton<span>&#46;</span>edu</a></div>
<div class="line">Thanks Hylke for making it available for use and modification</div>
<div class="line">Modified by Peter Burek</div>
</div>
<div class="line-block">
<div class="line">The submodule Hydrostats was created 2011 by:</div>
<div class="line">Sat Kumar Tomer (modified by Hylke Beck)</div>
<div class="line">Please see his book <a class="reference external" href="http://greenteapress.com/pythonhydro/pythonhydro.pdf">Python in Hydrology</a></div>
</div>
<section id="calibration-method">
<h2>Calibration method<a class="headerlink" href="#calibration-method" title="Permalink to this heading"></a></h2>
<p>Calibration is using an evolutionary computation framework in Python called DEAP (Fortin et al., 2012). We used the implemented evolutionary algorithm NSGA-II (Deb et al., 2002) for single objective optimization.
As objective function we used the modified version of the Kling-Gupta Efficiency (Kling et al., 2012), 2012), with r as the correlation coefficient between simulated and observed discharge (dimensionless), β as the bias ratio (dimensionless) and γ as the variability ratio.</p>
<div class="line-block">
<div class="line"><span class="math">KGE' = 1-\sqrt{(r-1)^2) + (\beta -1)^2 + (\gamma-1)^2 }</span></div>
<div class="line">where: <span class="math">\beta = \frac{\mu_s}{\mu_o}</span>   and    <span class="math">\gamma = \frac{CV_s}{CV_o} =  \frac{\sigma_s/\mu_s}{\sigma_o/\mu_o}</span></div>
</div>
<p>Where CV is the coefficient of variation, μ is the mean streamflow [m3 s−1] and σ is the standard deviation of the streamflow [m3 s−1]. KGE’, r, β and γ have their optimum at unity. The KGE’ measures the Euclidean distance from the ideal point (unity) of the Pareto front and is therefore able to provide an optimal solution which is simultaneously good for bias, flow variability, and correlation. For a discussion of the KGE objective function and its advantages over the often used Nash–Sutcliffe Efficiency (NSE) or the related mean squared error see (Gupta et al., 2009).
The calibration uses general a population size (µ) of 256, a recombination pool size (λ) of 32.The number of generations was set to 30, which we found was sufficient to achieve convergence for stations</p>
<section id="further-ideas-for-calibration">
<h3>Further ideas for calibration<a class="headerlink" href="#further-ideas-for-calibration" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>Regionalization see (Samaniego et al. 2017) and (Beck et al. 2016)</p></li>
<li><p>Using Budyko see (Greve et al. 2016)</p></li>
</ul>
</section>
</section>
<section id="suggested-calibration-parameters">
<h2>Suggested Calibration parameters<a class="headerlink" href="#suggested-calibration-parameters" title="Permalink to this heading"></a></h2>
<div class="line-block">
<div class="line"><strong>Snow</strong></div>
<div class="line">1.    Snowmelt coefficient in [m/C deg/day]  as a degree-day factor</div>
<div class="line"><strong>Evapotranspiration</strong></div>
<div class="line">2.    Crop factor as an adjustment to crop evapotranspiration</div>
<div class="line"><strong>Soil</strong></div>
<div class="line">3.    Soil depth factor: a factor for the overall soil depth of soil layer 1 and 2</div>
<div class="line">4.    Preferential bypass flow: empirical shape parameter of the preferential flow relation</div>
<div class="line">5.    Infiltration capacity parameter: empirical shape parameter b of the ARNO model</div>
<div class="line"><strong>Groundwater</strong></div>
<div class="line">6.    Interflow factor: factor to  adjust the amount which percolates from interflow to groundwater</div>
<div class="line">7.    Recession coefficient factor: factor to adjust the base flow recession constant (the contribution from groundwater to baseflow)</div>
<div class="line"><strong>Routing</strong></div>
<div class="line">8.    Runoff concentration factor: a factor for the concentration time of run-off in each grid-cell</div>
<div class="line">9.    Channel Manning’s n factor: a factor roughness in channel routing</div>
<div class="line">10.   Channel, lake and river evaporation factor: factor to adjust open water evaporation</div>
<div class="line"><strong>Reservoir &amp; lakes</strong></div>
<div class="line">11.   Normal storage limit: the fraction of storage capacity used as normal storage limit</div>
<div class="line">12.   Lake A factor : factor to channel width and weir coefficient as a part of the Poleni weir equation</div>
</div>
</section>
<section id="calibration-tool-structure">
<h2>Calibration tool structure<a class="headerlink" href="#calibration-tool-structure" title="Permalink to this heading"></a></h2>
<div class="highlight-rest notranslate"><div class="highlight"><pre><span></span>calibration
│-  readme.txt
│-  readme.txt
│
└--observed_data
│   └- lobith2006.cvs, ...
│
└--templates
│   └-- runpy.bat, runpy.sh
│   └-- settings.ini
</pre></div>
</div>
</section>
<section id="how-it-works">
<h2>How it works<a class="headerlink" href="#how-it-works" title="Permalink to this heading"></a></h2>
<p>The calibration tool builds up a single-objective obtimization framework using the Python libray DEAP
For each run it triggers the run of the hydrological model:</p>
<ul class="simple">
<li><p>using a template of the settings file</p></li>
<li><p>replacing the output folder in this template file</p></li>
<li><p>replace placeholders with the values of calibration parameters, the limit of the parameter range is given in the file: ParamRanges.csv</p></li>
</ul>
<p>After each run the model run is compared to observed values (e.g. observed_data/lobith2006.csv)</p>
<p>After the calibration, statistics and the best run is printed output</p>
</section>
<section id="what-is-needed">
<h2>What is needed<a class="headerlink" href="#what-is-needed" title="Permalink to this heading"></a></h2>
<div class="line-block">
<div class="line"><strong>1.</strong> The template files in ../templates have to be adjusted</div>
</div>
<ul class="simple">
<li><p>runpy.bat: the path to cwatm.py have to be set correctly (for linux a .sh file has to be created)</p></li>
<li><p>The actual version of a cwatm settings file has to modified:</p></li>
<li><p>replacing the output folder with the placeholder: %run_rand_id</p></li>
</ul>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="linenos">28</span><span class="c1">#-------------------------------------------------------</span><span class="w"></span>
<span class="linenos">29</span><span class="c1"># CALIBARTION PARAMETERS</span><span class="w"></span>
<span class="linenos">30</span><span class="c1">#-------------------------------------------------------</span><span class="w"></span>
<span class="linenos">31</span><span class="k">[CALIBRATION]</span><span class="w"></span>
<span class="linenos">32</span>
<span class="linenos">33</span><span class="c1"># These are parameter which are used for calibration</span><span class="w"></span>
<span class="linenos">34</span><span class="c1"># could be any parameter, but for an easier overview, tehey are collected here</span><span class="w"></span>
<span class="linenos">35</span><span class="c1"># in the calibration template a placeholder (e.g. %arnoBeta) instead of value</span><span class="w"></span>
<span class="linenos">36</span>
<span class="linenos">37</span><span class="na">OUT_Dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">%run_rand_id</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><p>putting the output variables in e.g. OUT_TSS_Daily = discharge or monthly average discharge OUT_TSS_MonthAvg = discharge</p></li>
</ul>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="linenos">38</span><span class="na">OUT_TSS_Daily</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">discharge</span><span class="w"></span>
<span class="linenos">39</span><span class="na">OUT_TSS_MonthAvg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">discharge</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><p>delete all the output variables in the template (mostly at the end of the file)</p></li>
<li><p>replacing calibration parameter values with a placeholder: e.g. %SnowMelt</p></li>
</ul>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="linenos">42</span><span class="c1"># Snow  SnowMeltCoef = 0.004</span><span class="w"></span>
<span class="linenos">43</span><span class="na">SnowMeltCoef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">%SnowMelt</span><span class="w"></span>
<span class="linenos">44</span><span class="c1"># Cropf factor correction</span><span class="w"></span>
<span class="linenos">45</span><span class="na">crop_correct</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="s">%crop</span><span class="w"></span>
<span class="linenos">46</span><span class="c1">#Soil</span><span class="w"></span>
<span class="linenos">47</span><span class="na">soildepth_factor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">%soildepthF</span><span class="w"></span>
<span class="linenos">48</span><span class="c1">#Soil preferentialFlowConstant = 4.0, arnoBeta_factor = 1.0</span><span class="w"></span>
<span class="linenos">49</span><span class="na">preferentialFlowConstant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">%pref</span><span class="w"></span>
<span class="linenos">50</span><span class="na">arnoBeta_add</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">%arnoB</span><span class="w"></span>
<span class="linenos">51</span><span class="c1"># interflow part of recharge factor = 1.0</span><span class="w"></span>
<span class="linenos">52</span><span class="na">factor_interflow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">%interF</span><span class="w"></span>
<span class="linenos">53</span><span class="c1"># groundwater recessionCoeff_factor = 1.0</span><span class="w"></span>
<span class="linenos">54</span><span class="na">recessionCoeff_factor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">%reces</span><span class="w"></span>
<span class="linenos">55</span><span class="c1"># runoff concentration factor runoffConc_factor = 1.0</span><span class="w"></span>
<span class="linenos">56</span><span class="na">runoffConc_factor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">%runoff</span><span class="w"></span>
<span class="linenos">57</span><span class="c1">#Routing manningsN factor [0.1 - 10.0] default  1.0</span><span class="w"></span>
<span class="linenos">58</span><span class="na">manningsN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">%CCM</span><span class="w"></span>
<span class="linenos">59</span><span class="c1"># reservoir  normal storage limit (fraction of total storage, [-]) [0.15 - 0.85] default 0.5</span><span class="w"></span>
<span class="linenos">60</span><span class="na">normalStorageLimit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">%normalStorageLimit</span><span class="w"></span>
<span class="linenos">61</span><span class="c1"># lake parameter - factor to alpha: parameter of of channel width and weir coefficient  [0.33 - 3.] dafault 1.</span><span class="w"></span>
<span class="linenos">62</span><span class="na">lakeAFactor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">%lakeAFactor</span><span class="w"></span>
<span class="linenos">63</span><span class="c1"># lake wind factor - factor to evaporation from lake [0.8 - 2.] dafault 1.</span><span class="w"></span>
<span class="linenos">64</span><span class="na">lakeEvaFactor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">%lakeEvaFactor</span><span class="w"></span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><strong>2.</strong> the range of parameter space has to be defined in ParamRanges.csv</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ParameterName</span><span class="p">,</span><span class="n">MinValue</span><span class="p">,</span><span class="n">MaxValue</span>
<span class="n">SnowMelt</span><span class="p">,</span><span class="mf">0.001</span><span class="p">,</span><span class="mf">0.007</span>
<span class="n">crop</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">3.0</span>
<span class="n">soildepthF</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span><span class="mf">1.8</span>
<span class="n">pref</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">8</span>
<span class="n">arnoB</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">1.0</span>
<span class="n">interF</span><span class="p">,</span> <span class="mf">0.33</span><span class="p">,</span><span class="mf">3.0</span>
<span class="n">reces</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mi">10</span>
<span class="n">runoff</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mi">5</span>
<span class="n">CCM</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">10.0</span>
<span class="n">normalStorageLimit</span><span class="p">,</span><span class="mf">0.15</span><span class="p">,</span><span class="mf">0.85</span>
<span class="n">lakeAFactor</span><span class="p">,</span><span class="mf">0.333</span><span class="p">,</span><span class="mf">3.0</span>
<span class="n">lakeEvaFactor</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">3.0</span>
<span class="n">No</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><strong>3.</strong> The observed discharge has to be provided in an .cvs file e.g. observed_data/lobith2006.csv</div>
</div>
<div class="line-block">
<div class="line">In the template settings the date has to be set, so that the period of observed discharge is between SpinUp and StepEnd</div>
</div>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">#-------------------------------------------------------</span><span class="w"></span>
<span class="linenos"> 2</span><span class="k">[TIME-RELATED_CONSTANTS]</span><span class="w"></span>
<span class="linenos"> 3</span><span class="c1">#-------------------------------------------------------</span><span class="w"></span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="c1"># StepStart has to be a date e.g. 01/06/1990</span><span class="w"></span>
<span class="linenos"> 6</span><span class="c1"># SpinUp or StepEnd either date or numbers </span><span class="w"></span>
<span class="linenos"> 7</span><span class="c1"># SpinUp: from this date output is generated (up to this day: warm up)</span><span class="w"></span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="na">StepStart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1/1/1990</span><span class="w"></span>
<span class="linenos">10</span><span class="na">SpinUp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1/1/1995</span><span class="w"></span>
<span class="linenos">11</span><span class="na">StepEnd</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="s">31/12/2010</span><span class="w"></span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><strong>4.</strong> And empty ../catchments directory needs to be created</div>
</div>
<div class="line-block">
<div class="line"><strong>5.</strong> A few option in the settings.txt have to be adjusted (how many runs?, a first run with standard parameters? etc)</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">DEFAULT</span><span class="p">]</span>
<span class="n">Root</span> <span class="o">=</span> <span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">watmodel</span><span class="o">/</span><span class="n">CWATM</span>
<span class="n">RootPC</span> <span class="o">=</span> <span class="n">C</span><span class="p">:</span><span class="o">/</span><span class="n">watmodel</span><span class="o">/</span><span class="n">CWATM</span>
<span class="n">Rootbasin</span> <span class="o">=</span> <span class="n">calibration_rhine</span>

<span class="n">ForcingStart</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">1</span><span class="o">/</span><span class="mi">2000</span>
<span class="n">ForcingEnd</span> <span class="o">=</span> <span class="mi">31</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="mi">2010</span>
<span class="n">timeperiod</span> <span class="o">=</span> <span class="n">daily</span>

<span class="p">[</span><span class="n">ObservedData</span><span class="p">]</span>
<span class="n">Qtss</span> <span class="o">=</span> <span class="n">observed_data</span><span class="o">/</span><span class="n">lobith</span><span class="o">.</span><span class="n">csv</span>
<span class="n">Column</span> <span class="o">=</span> <span class="n">lobith</span>
<span class="n">Header</span> <span class="o">=</span> <span class="n">River</span><span class="p">:</span> <span class="n">Rhine</span>  <span class="n">station</span><span class="p">:</span> <span class="n">Lobith</span>

<span class="p">[</span><span class="n">Validate</span><span class="p">]</span>
<span class="n">Qtss</span> <span class="o">=</span> <span class="n">observed_data</span><span class="o">/</span><span class="n">lobith_val</span><span class="o">.</span><span class="n">csv</span>
<span class="n">ValStart</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">1</span><span class="o">/</span><span class="mi">1990</span>
<span class="n">ValEnd</span> <span class="o">=</span> <span class="mi">31</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="mi">1999</span>


<span class="p">[</span><span class="n">Path</span><span class="p">]</span>
<span class="n">Templates</span> <span class="o">=</span> <span class="n">templates</span>
<span class="n">SubCatchmentPath</span> <span class="o">=</span> <span class="n">catchments</span>
<span class="n">ParamRanges</span> <span class="o">=</span> <span class="n">ParamRanges</span><span class="o">.</span><span class="n">csv</span>

<span class="p">[</span><span class="n">Templates</span><span class="p">]</span>
<span class="n">ModelSettings</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">ini</span>
<span class="n">RunModel</span> <span class="o">=</span> <span class="n">runpy</span><span class="o">.</span><span class="n">sh</span>

<span class="p">[</span><span class="n">Option</span><span class="p">]</span>
<span class="n">firstrun</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">para_first</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0022</span><span class="p">,</span> <span class="mf">1.72</span><span class="p">,</span> <span class="mf">1.24</span><span class="p">,</span> <span class="mf">7.07</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="mf">1.92</span><span class="p">,</span> <span class="mf">2.81</span><span class="p">,</span> <span class="mf">0.74</span><span class="p">,</span><span class="mf">1.34</span><span class="p">,</span><span class="mf">0.35</span><span class="p">,</span><span class="mf">2.04</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]</span>
<span class="c1"># Snowmelt, crop KC, soil depth,pref. flow, arno beta, interflow factor, groundwater recession,</span>
<span class="c1"># runoff conc., routing, manning factor, normalStorageLimit, lakeAFactor,lakeEvaFactor,No of run</span>
<span class="n">bestrun</span> <span class="o">=</span> <span class="kc">True</span>

<span class="p">[</span><span class="n">DEAP</span><span class="p">]</span>
<span class="n">maximize</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">use_multiprocessing</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">ngen</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mi">256</span>
<span class="n">lambda_</span> <span class="o">=</span> <span class="mi">32</span>


</pre></div>
</div>
<div class="line-block">
<div class="line"><strong>6.</strong> run python calibration_single.py settings.txt</div>
</div>
</section>
<section id="recommendations">
<h2>Recommendations<a class="headerlink" href="#recommendations" title="Permalink to this heading"></a></h2>
<div class="line-block">
<div class="line"><strong>1.</strong> Run the model first to store the pot. evaporation results</div>
</div>
<div class="line-block">
<div class="line">Afterwards use the stored evaporation to run the calibration</div>
<div class="line">calc_evaporation = False</div>
</div>
<div class="line-block">
<div class="line"><strong>2.</strong> Run the model and store the last day to be used as initial condition for the calibration runs</div>
</div>
<div class="line-block">
<div class="line">Best is to use a long term run for this.</div>
</div>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="linenos">146</span><span class="k">[INITITIAL CONDITIONS]</span><span class="w"></span>
<span class="linenos">147</span><span class="c1">#-------------------------------------------------------</span><span class="w"></span>
<span class="linenos">148</span>
<span class="linenos">149</span><span class="c1"># for a warm start initial variables a loaded</span><span class="w"></span>
<span class="linenos">150</span><span class="c1"># e.g for a start on 01/01/2010 load variable from 31/12/2009</span><span class="w"></span>
<span class="linenos">151</span><span class="na">load_initial</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">False</span><span class="w"></span>
<span class="linenos">152</span><span class="na">initLoad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">$(FILE_PATHS:PathRoot)/init/Rhine_19891231.nc</span><span class="w"></span>
<span class="linenos">153</span>
<span class="linenos">154</span><span class="c1"># saving variables from this run, to initiate a warm start next run</span><span class="w"></span>
<span class="linenos">155</span><span class="c1"># StepInit = saving date, can be more than one: 10/01/1973 20/01/1973</span><span class="w"></span>
<span class="linenos">156</span><span class="na">save_initial</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">False</span><span class="w"></span>
<span class="linenos">157</span><span class="na">initSave</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">$(FILE_PATHS:PathRoot)/init/Rhine</span><span class="w"></span>
<span class="linenos">158</span><span class="na">StepInit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">31/12/1989 31/12/2010</span><span class="w"></span>
</pre></div>
</div>
<div class="line-block">
<div class="line">load_initial = False</div>
<div class="line">save_initial = True</div>
</div>
<div class="line-block">
<div class="line">During calibration use:</div>
<div class="line">load_initial = True</div>
<div class="line">save_initial = False</div>
</div>
<div class="line-block">
<div class="line"><strong>3.</strong> Use a long SpinUp time (&gt; 5 years to give groundwater enough time)</div>
</div>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p>Beck, H. E., A. I. J. M. van Dijk, A. de Roo, D. G. Miralles, T. R. McVicar, J. Schellekens and L. A. Bruijnzeel (2016). “Global-scale regionalization of hydrologic model parameters.” Water Resources Research 52(5): 3599-3622.</p></li>
<li><p>Deb, K., A. Pratap, S. Agarwal and T. Meyarivan (2002). “A fast and elitist multiobjective genetic algorithm: NSGA-II.” IEEE Transactions on Evolutionary Computation 6(2): 182-197.</p></li>
<li><p>Fortin, F. A., F. M. De Rainville, M. A. Gardner, M. Parizeau and C. Gagńe (2012). “DEAP: Evolutionary algorithms made easy.” Journal of Machine Learning Research 13: 2171-2175.</p></li>
<li><p>Greve, P., L. Gudmundsson, B. Orlowsky and S. I. Seneviratne (2016). “A two-parameter Budyko function to represent conditions under which evapotranspiration exceeds precipitation.” Hydrology and Earth System Sciences 20(6): 2195-2205.</p></li>
<li><p>Gupta, H. V., H. Kling, K. K. Yilmaz and G. F. Martinez (2009). “Decomposition of the mean squared error and NSE performance criteria: Implications for improving hydrological modelling.” Journal of Hydrology 377(1-2): 80-91.</p></li>
<li><p>Kling, H., M. Fuchs and M. Paulin (2012). “Runoff conditions in the upper Danube basin under an ensemble of climate change scenarios.” Journal of Hydrology 424-425: 264-277.</p></li>
<li><p>Samaniego, L., R. Kumar, S. Thober, O. Rakovec, M. Zink, N. Wanders, S. Eisner, H. Müller Schmied, E. Sutanudjaja, K. Warrach-Sagi and S. Attinger (2017). “Toward seamless hydrologic predictions across spatial scales.” Hydrology and Earth System Sciences 21(9): 4323-4346.</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="data.html" class="btn btn-neutral float-left" title="10. Data" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="calibration_tutorial.html" class="btn btn-neutral float-right" title="12. Calibration tutorial" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, IIASA Water Security.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>